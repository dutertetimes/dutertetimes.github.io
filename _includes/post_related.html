{% comment %}
<!-- The following code snippet was taken from http://zhangwenli.com -->
<!-- http://zhangwenli.com/blog/2014/07/15/jekyll-related-posts-without-plugin/ -->
{% endcomment %}
{% capture empty %}
{% assign list_posts = "" | split: "" %}
{% assign counter = 0 %}
{% assign max_post_count = 5 %}

{% assign foundPost = false %}
{% for post in site.categories['news'] %}
    {% if post.title != page.title %}
        {% for page_tag in page.tags %}
            {% if post.tags contains page_tag %}
                {% assign foundPost = true %}
                {% break %}
            {% endif %}
        {% endfor %}

        {% if foundPost == true %}
            {% assign list_posts = list_posts | push: post %}
            {% assign foundPost = false %}
            {% assign counter = counter | plus: 1 %}
            {% if counter == max_post_count %}
                {% break %}
            {% endif %}
        {% endif %}
    {% endif %}
{% endfor %}

{% assign show_items = "" | split: "" %}
{% assign show_items = show_items | push: "date" %}
{% assign show_items = show_items | push: "excerpt" %}
{% assign show_items = show_items | push: "description" %}
{% endcapture %}{% assign empty = nil %}
<div id="related_posts_section" class="section_container_wrapper section_container_wrapper_border">
    <h1>Related Posts</h1>

    <div class="section_container top_margin_10">
        {% include block_default.html posts=list_posts show=show_items %}
    </div>
</div>
